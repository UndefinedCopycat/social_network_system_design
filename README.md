# System Design социальной сети для [курса по System Design](https://balun.courses/courses/system_design)

# **Разработка социальной сети**
## **Требования к системе:**
### **Функциональные требования:**
- Система должна предоставлять пользователю возможность регистрироваться и авторизовываться в системе;
- Система должна предоставлять пользователю возможность просматривать свой личный кабинет.

1. > Публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;

- Система должна предоставлять пользователю возможность публиковать записи:
  - Система должна предоставлять пользователю возможность создавать записи;
  - Система должна предоставлять пользователю возможность просматривать опубликованные записи;
  - Система при отображении должна сортировать опубликованные записи по убыванию даты;
  - Система должна предоставлять пользователю возможность прикреплять к публикуемым записям текст;
  - Система должна предоставлять пользователю возможность прикреплять к публикуемым записям фотографии;
  - Система должна предоставлять пользователю возможность прикреплять к публикуемым записям геолокацию в формате координат в виде ссылки на точку на карте.

2. > Оценка и комментарии постов других путешественников;

- Система должна предоставлять пользователю возможность оценивать опубликованные другими пользователями записи:
  - Система должна предоставлять пользователю возможность выставлять записи другого пользователя лайк;
  - Система должна предоставлять пользователю возможность выставлять записи другого пользователя дизлайк.
- Система должна предоставлять пользователю возможность создавать и публиковать комментарии к опубликованным другими пользователями записям.

3. > Подписка на других путешественников, чтобы следить за их активностью;

- Система должна предоставлять пользователю возможность осуществлять подписку на других пользователей:
	- Система должна формировать список записей всех пользователей, на которые подписан текущий пользователь;
  - Система должна сотритовать отображаемые записи других пользователей по убыванию даты.

4. > Поиск популярных мест для путешествий и просмотр постов с этих мест в виде ТОПа мест по странам и городам;

- Система должна предоставлять пользователю возможность найти все записи по области радиусом 100 метров от заданных координат;
- Система должна предоставлять пользователю возможность найти все записи по области радиусом 1000 метров от заданных координат;
- Система должна предоставлять пользователю возможность найти все записи по выбранному городу;
- Система должна предоставлять пользователю возможность найти все записи по выбранной стране.
- При поиске мест система должна сортировать отображаемые записи по формуле 
{количество просмотров} * {количество лайков} / {количество дизлайков} - чем больше значение, тем выше запись.

5. > Общение с другими путешественниками в личных сообщениях;

- Система должна предоставлять пользователю возможность обмениваться сообщениями с другими пользователями:
  - Система должна предоставлять возможность открыть чат с конкретным пользователем;
  - Система должна предоставлять возможность написать и отправить сообщение другому пользователю;
  - Система должна предоставлять возможность просматривать полученные и отправленные в конкретном чате сообщения.

6. > Просмотр ленты других путешественников;

- Система должна предоставлять возможность просматривать ленту публикаций конкретного пользователя:
  - Система должна предоставлять возможность просматривать записи, опубликованные другими пользователями;
  - Система должна сотритовать отображаемые записи других пользователей по убыванию даты.

### **Нефункциональные требования:**
- Система должна отображать список записей других пользователей максимум за 1 секунду;
- Система должна обрабатывать запросы обмена сообщений между пользователями максимум за 1 секунду;
- Система должна поддерживать ранее указанную производительность при наличии до 12 млн пользователей;
- Система должна быть досутпной для использования 99.95% всего времени (availability);
- Записи и сообщения польщователей необходимо хранить всегда;
- Предположительный DAU через год после развёртывания проекта = 10 000 000;
- Пранируемый охват аудитории - весь мир;
- Каждый пользователь в среднем будет просматривать свой профиль 1 раз в день;
- Каждый пользователь в среднем будет делать до 5-ти записей в неделю (примерно 1 запись в день);
- Каждый пользователь в среднем будет оставлять до 20 оценок в день;
- Каждый пользователь в среднем будет отправлять до 50-ти сообщений в день;
- Каждый пользователь в среднем будет оставлять до 5 комментариев в день;
- Пользователь = идентификатор пользователя, номер телефона, наименование пользователя, дата создания аккаунта;
- Публикуемая запись = идентификатор записи, индентификатор пользователя, дата публикации, текст (максимум 2000 символов), изображение (необязательно), метка на карте (необязательно): координата Y + координата X, количество комментариев, количество лайков, количество дизлайков;
- Комментарий = идентификатор записи, идентификатор комментария, идентификатор пользователя (который оставил комментарий), текст (максимум 1000 символов), дата оставления комментария;
- Оценка (лайк/дизлайк) = идентификатор записи, идентификатор пользователя, дата проставления оценки; 
- Сообщение = идентификатор сообщения, идентификатор чата, текст (максимум 2000 символов), дата отправки, флаг "прочитано";
- В выдаче записей других пользователей (как подписки, так и при поиске) показываем за раз 20 записей (используем пагинацию);

### **Оценка нагрузки на разрабатываемую систему:**
1. Профиль пользователя:
Планируется 10 000 000 уникальных пользователей в день.
- Идентификатор пользователя = 24 бита (с заделом на рост аудитории);
- Номер телефона = 192 бита;
- Наименование пользователя (максимум 20 символов) = 320 бит;
- Дата создания аккаунта = 160 бит.
*Рассчёт:*
(24 + 192 + 320 + 160) * 10 000 000 = 6 960 000 000 бит / 86400 = 80 555 бит = 10 КБ/с

2. Публикуемая запись:
Планируется примерно 1 запись в день от одного пользователя.
- Идентификтаор записи = 33 бита;
- Индентификатор пользователя = 24 бита (с заделом на рост аудитории);
- Дата публикации = 448 бит (в timestamp);
- Текст = 32 000 бит;
- Изображение = 240 000 000 бит (в среднем фото весит 30 мб);
- Метка (координаты Y) = 128 бит;
- Метка (координаты X) = 128 бит;
- Кол-во комментариев = 15 бит (ограничение на 20 тысяч комментариев);
- Кол-во лайков = 21 бит (ограничение в 2 миллиона лайков);
- Кол-во дизлайков = 21 бит (ограничение в 2 миллиона дизлайков).
*Расчёт:*
(448 + 32 000 + 240 000 000 + 128 + 128 + 15 + 21 + 21) * 10 000 000 = 300 ТБ (основной объём - фото) / 86400 = 3,47 ГБ/с

3. Комментарий:
Планируется примерно 5 комментариев в день от одного пользователя.
- Идентификатор записи = 33 бита;
- Идентификатор комментария = 33 бита;
- Идентификатор пользователя = 24 бита (с заделом на рост аудитории);
- Текст = 16 000 бит;
- Дата оставления комментария = 448 бит (в timestamp).
*Расчёт:*
(33 + 33 + 24 + 16 000 + 448) * 5 * 10 000 000 = 103,3625 ГБ / 86400 = 1,19 МБ/с

4. Оценка:
Планируется примерно 20 оценок в день от одного пользователя.
- Идентификатор записи = 33 бита;
- Идентификатор пользователя = 24 бита (с заделом на рост аудитории);
- Дата проставления оценки = 448 бит (в timestamp).
*Расчёт:*
(33 + 24 + 448) * 20 * 10 000 000 = 23 Гб / 86400 = 266 Кб/с

5. Сообщение:
Планируется примерно 50 сообщений в день от одного пользователя.
идентификатор сообщения, идентификатор чата, текст (максимум 2000 символов), дата отправки, флаг "прочитано"
- Идентификатор сообщения = guid - 128 бит;
- Идентификатор чата = guid - 128 бит;
- Текст = 32 000 бит;
- Дата отправки = 448 бит (в timestamp);
- Флаг "прочитано" = 1 бит;
*Расчёт:*
(128 + 128 + 32 000 + 448 + 1) * 50 * 10 000 000 = 2 ТБ / 86400 = 23,65 Мб/с

6. Показ записей других пользователей:
Предполагаем, что пользователь будет просматривать ленту 3 раза в день, пролистывая 4 пачки записей.
*Расчёт:*
300 ТБ (вес одной публикации в день) * 3 раза * 4 пачки = 3 600 ТБ /день / 86 400= 4,16 ГБ/с

7. Общий трафик: 7,6617 Гб/с.


8. RPS:
((3 * 4) + 50 + 20 + 5 + 1) * 10 000 000 / 86 400 = 10 185
